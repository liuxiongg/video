var timeout = 6,
defaultComment = '在这里输入...',
curInfoBlock, curError = 1,
curBlockInfoId = 0;
function toggleIntro() {
	var a = m.g("intro").innerHTML;
	m.g("intro").innerHTML = m.g("hidden_intro").value;
	m.g("hidden_intro").value = a
}
function get_childnodes(a) {
	var b = a.childNodes;
	var c = b.length;
	var d = new Array();
	if ((m.brower() == "chrome") || (m.brower() == "ff") || (m.brower() == "ie9")) {
		for (var i = 0; i < c; i++) {
			if (b[i].nodeName != "#text") {
				d.push(b[i])
			}
		}
		return d
	} else {
		return b
	}
}
function subString(a, b, c) {
	var d = 0;
	var e = "";
	var f = /[^\x00-\xff]/g;
	var g = "";
	var h = a.replace(f, "**").length;
	for (var i = 0; i < h; i++) {
		g = a.charAt(i).toString();
		if (g.match(f) != null) {
			d += 1
		} else {
			d++
		}
		if (d > b) {
			break
		}
		e += g
	}
	if (c && h > b) {
		e += "..."
	}
	return e
}
function add_fav_d(a, b) {
	var a = '电影大全-2345.com_网址导航_' + a;
	var c = dUrl.replace('ID', b);
	try {
		window.external.addFavorite(c, a)
	} catch(e) {
		try {
			window.sidebar.addPanel(a, c, "")
		} catch(e) {
			alert("\u60a8\u53ef\u4ee5\u5c1d\u8bd5\u901a\u8fc7\u5feb\u6377\u952e Ctrl+D \u52a0\u5165\u5230\u6536\u85cf\u5939~")
		}
	}
	return false
}
function comFocus(a) {
	if (a.value == defaultComment) {
		a.value = "";
		a.style.color = '#333'
	}
}
function comBlur(a) {
	if (a.value == "") {
		a.value = defaultComment;
		a.style.color = '#999'
	}
}
function fnGetComment(a, b) {
	var c = new Date();
	m.loadJs(jsUrl + "?action=get_comment&id=" + id + "&page=" + a + "&type=" + b + "&t=" + new Date().getTime() + '&stype=' + mediaType)
}
function getAllCom(a) {
	m.loadJs(jsUrl + "?action=getOneComment&id=" + a + '&stype=' + mediaType)
}
function load_comment_con(a) {
	var b = a['content'];
	b += "<a  href='#' onclick='getLessCom(" + a['id'] + ");return false;'><<收起</a>";
	m.g("comText" + a['id']).innerHTML = b
}
function getLessCom(a) {
	m.g("comText" + a).innerHTML = m.g("hiddenText" + a).innerHTML + "<a  href='#' onclick=\"getAllCom(" + a + ");return false;\">展开>></a>"
}
function load_comment(a) {
	var b = a['page'],
	com_list = a['list'],
	com_html = "",
	dp_html = "",
	length = com_list.length;
	if (length > 0) {
		for (var i = 0; i < length; i++) {
			concat.append("<li>");
			concat.append("<div class=\"bottomLine clearfix\"><p id='comText");
			concat.append(a['list'][i]['id'] + "'>" + a['list'][i]['content']);
			if (a['list'][i]['is_cut'] == 1) {
				concat.append("<a  href='#' onclick=\"getAllCom(");
				concat.append(a['list'][i]['id'] + ");return false;\">展开>></a>")
			}
			concat.append("</p><span class=\"sTime\">" + a['list'][i]['time']);
			concat.append("</span></div>");
			if (a['list'][i]['is_cut'] == 1) {
				concat.append("<p style='display:none' id='hiddenText");
				concat.append(a['list'][i]['id'] + "'>");
				concat.append(a['list'][i]['content'] + "</p>")
			}
			concat.append("</li>")
		}
		m.g("comment_ul").innerHTML = concat.out();
		if (a['page']['total_num'] > 1) {
			dp_html += "<strong>" + a['page']['current'] + "</strong>/" + a['page']['total_num'];
			if (a['page']['have_pre'] == 1) {
				dp_html += "<a href=\"" + a['page']['pre_page'] + "\" class=\"up\" onclick=\"fnGetComment(" + a['page']['pre_page'] + ",'2345');return false;\">上一页</a>"
			}
			if (a['page']['have_next'] == 1) {
				dp_html += "<a href=\"" + a['page']['next_page'] + "\" class=\"down\" onclick=\"fnGetComment(" + a['page']['next_page'] + ",'2345');return false;\">下一页</a>"
			}
			m.g("dp_page").innerHTML = dp_html
		}
	}
}
function submit_com(e) {
	var f = m.g(e);
	var g = f.value;
	var h = f.parentNode.getElementsByTagName('input')[0];
	var i = f.parentNode.getElementsByTagName('img')[0];
	if (g == GetCookie('comment_' + id)) {
		alert('亲，请不要提交重复内容哦~~');
		return false
	}
	if (/^([0-9a-zA-Z \r\n]+)$/.test(g)) {
		alert('一连串纯数字或纯字母是不能提交的哦~~ ');
		return false
	}
	if (g.indexOf('.cc') != -1 || g.indexOf('.net') != -1 || g.indexOf('http:\/\/') != -1 || g.indexOf('.com') != -1 || g.indexOf('.cn') != -1 || g.indexOf('www') != -1) {
		alert('链接不能提交的哦~~ ');
		return false
	}
	if (h.value.replace(/^\s+|\s+$/g, "") == "" || h.value.replace(/^\s+|\s+$/g, "") == "点此输入验证码") {
		alert('亲，请输入验证码哦~~');
		return false
	}
	if (g.replace(/^\s+|\s+$/g, "") != "" && g.replace(/^\s+|\s+$/g, "") != defaultComment) {
		m.g("hidden_comment").value = g;
		m.ajax.post('post', {
			'action': 'subComment',
			'id': id,
			'content': g,
			'stype': mediaType,
			'pImgCode': h.value
		},
		ajaxUrl,
		function(a) {
			if (a == "success") {
				var b = cookieExpires;
				cookieExpires = 120;
				SetCookie('comment_' + id, g);
				cookieExpires = b;
				var c = new Date();
				var d = c.getFullYear() + "-" + (c.getMonth() < 9 ? "0" + (c.getMonth() + 1) : (c.getMonth() + 1)) + "-" + (c.getDate() < 10 ? "0" + c.getDate() : c.getDate());
				m.g("comment_ul").innerHTML = "<li class=\"liSelected\"><div class=\"bottomLine clearfix\"><p>" + m.g("hidden_comment").value + "</p><span class=\"sTime\">" + d + "</span></div></li>" + m.g("comment_ul").innerHTML;
				setTimeout("m.g(\"comment_ul\").firstChild.className='';", 2050);
				m.g('comment_box').style.display = 'none';
				m.g('quick_com_tab').style.display = '';
				f.value = defaultComment;
				f.style.color = "#999";
				window.scrollTo(0, xloadImg.getDomObjABSY(m.g('comment_textarea2')));
				i.src = imgCodeUrl + '?' + new Date().getTime();
				h.value = "";
				fnImgCodeBlur(h)
			} else if (a == "dirty_words") {
				alert("评论需审核，请您耐心等待...");
				i.src = imgCodeUrl + '?' + new Date().getTime();
				h.value = "";
				fnImgCodeBlur(h)
			} else if (a == "vic") {
				alert("亲，验证码输入错误哦~~");
				i.src = imgCodeUrl + '?' + new Date().getTime();
				h.value = "";
				fnImgCodeBlur(h)
			} else if (a == 're_comment') {
				alert('评论已成功！请不要反复提交哦。');
				f.value = defaultComment;
				f.style.color = "#999"
			}
			m.g('comment_header1').focus()
		})
	} else {
		alert("没有评论是不能提交的哦~~")
	}
}
function feedback() {
	var b = m.g("errorInput" + curError).value;
	var c = m.g("errorDefault" + curError).value;
	if (curError == 2) {
		var d = 0;
		var e = "";
		var f = m.g("api_feedback").getElementsByTagName("li");
		var g = f.length;
		for (var i = 0; i < g; i++) {
			var h = f[i].getElementsByTagName("input")[0];
			if (h.checked) {
				var j = f[i].getElementsByTagName("em")[0].innerHTML;
				e += " " + j;
				d = 1
			}
		}
	} else {
		var d = 1
	}
	if (d) {
		if (b.replace(/^\s+|\s+$/g, "") != "" && b != c) {
			if (e) {
				b = e + ":" + b
			}
			switch (mediaType) {
			case 'tv':
				var k = 'http://tv.2345.com/api/feedback.php';
				break;
			case 'dm':
				var k = 'http://v.2345.com/api/feedback.php';
				break;
			case 'movie':
				var k = 'http://dianying.2345.com/api/feedback.php';
				break
			}
			m.ajax.post('post', {
				'media': mediaType,
				'id': id,
				'content': b,
				'type': curError
			},
			k,
			function(a) {
				if (a == "ok") {
					m.g("feedbackBox").style.display = "none";
					m.g("feedbackSuccessBox").style.display = "block";
					if (mediaType != 'movie' || curError != 2) {
						m.g("errorInput" + curError).value = c
					}
					m.g("errorInput" + curError).style.color = '#999'
				} else if (a == "error101") {
					alert("提交失败，请填写相应信息")
				} else if (a == 'error102') {
					alert('提交失败，请稍等提交')
				}
			})
		} else {
			if (curError == 2) {
				alert("请填写无法观看的集数哦~~")
			} else {
				alert("没有报错是不能提交的哦~~")
			}
		}
	} else {
		alert("请勾选无法观看的视频站哦~~")
	}
}
function showFeedBack() {
	m.show(m.g("feedbackBox"));
	m.g("maskLayer").style.height = (document.body.scrollHeight + 100) + "px";
	m.g("maskLayer").style.display = 'block';
	m.hide(m.g("feedbackSuccessBox"))
}
function hideFeedBack() {
	m.hide(m.g("feedbackBox"));
	m.g("maskLayer").style.display = 'none'
}
function changeErrorCon(a) {
	for (var i = 1; i <= 5; i++) {
		if (a == i) {
			m.g("errorHead" + i).className = 'cur';
			m.g("errorCon" + i).style.display = 'block'
		} else {
			m.g("errorHead" + i).className = '';
			m.hide(m.g("errorCon" + i))
		}
	}
	curError = a
}
function hideFeedbackSuccess() {
	m.hide(m.g("feedbackSuccessBox"));
	m.g("maskLayer").style.display = 'none'
}
function get_rank2(a) {
	for (var i = 5; i <= 8; i++) {
		var b = "";
		if (i == a) {
			if (a == 8) {
				b = "cur end"
			} else {
				b = "cur"
			}
			if ((a == 6) || (a == 7) || (a == 8)) {
				m.g("rank_tab" + (i - 1)).className = "no-line"
			}
			m.show(m.g("rank_list" + i))
		} else {
			if (i == 8) {
				b = "end"
			}
			m.hide(m.g("rank_list" + i))
		}
		m.g("rank_tab" + i).className = b
	}
	for (var i = 1; i <= 10; i++) {
		if (m.g("rankl" + a + "_" + i).innerHTML.cnSize() > 24) {
			var c = m.g("rankl" + a + "_" + i).innerHTML.cutStr(24) + "..."
		} else {
			var c = m.g("rankl" + a + "_" + i).innerHTML
		}
		m.g("rankl" + a + "_" + i).innerHTML = c
	}
}
function showRank(a) {
	if (a == 1) {
		m.g("rankTab1").className = 'cur';
		m.g("rankTab2").className = '';
		m.show(m.g("rank1"));
		m.hide(m.g("rank2"))
	} else if (a == 2) {
		m.g("rankTab2").className = 'cur';
		m.g("rankTab1").className = '';
		m.show(m.g("rank2"));
		m.hide(m.g("rank1"))
	}
}
function showAllink(a) {
	m.g(a + 'numList').innerHTML = m.g(a + 'AllLink').innerHTML;
	showAll = 1
}
function show_info_block(a, b) {
	if (m.g('infoBlock_' + b + '_' + curBlockInfoId) != undefined) {
		m.hide(m.g('infoBlock_' + b + '_' + curBlockInfoId));
		m.show(m.g('infoBlock_' + b + '_' + a));
		m.g('infoBlockBanner_' + b + '_' + curBlockInfoId).className = '';
		m.g('infoBlockBanner_' + b + '_' + a).className = 'cur';
		curBlockInfoId = a
	}
}
function show(a, b) {
	if (!m.g(a + "_con")) {
		return false
	}
	var c = b.parentNode.getElementsByTagName("a");
	var d = c.length;
	for (var i = 0; i < d; i++) {
		if (c[i].className == 'cur') {
			capi = c[i].title
		}
	}
	m.g(capi + "_con").style.display = 'none';
	m.g(a + "_con").style.display = '';
	for (var i = 0; i < d; i++) {
		if (c[i].title == a) {
			c[i].className = 'cur'
		} else {
			c[i].className = ''
		}
	}
	if (showAll) {
		showAllink(a)
	}
	show_info_block(0, capi);
	show_info_block(0, a)
}
function show_info_list(a) {
	if (typeof arguments[1] == 'undefined') {
		var b = 1
	} else {
		var b = arguments[1]
	}
	for (var i = 0; i < 1000; i++) {
		if (m.g("info_list_con" + i) == undefined) {
			break
		}
		if (i == a) {
			m.g("info_list_con" + a).style.display = ''
		} else {
			m.g("info_list_con" + i).style.display = 'none'
		}
	}
	if (m.g("info_block" + curInfoBlock) != undefined) {
		m.g("info_block" + curInfoBlock).className = '';
		m.g("info_block_a_" + curInfoBlock).className = '';
		curInfoBlock = a;
		m.g("info_block" + curInfoBlock).className = 'cur';
		m.g("info_block_a_" + curInfoBlock).className = 'cur'
	}
	if (b == 1) window.scrollTo(0, xloadImg.getDomObjABSY(m.g('middle')))
}
function fnReviewTag(a) {
	if (!id) return false;
	st.sset('review_tag_value_' + id, a);
	fnEpisodeFoucs(a)
}
function fnEpisodeFoucs(a) {
	Fn('playNumList').tag('a').each(function() {
		if (Fn(this).html()) {
			if (this.title == a && Fn(this).html().indexOf('iPlayed') == -1) {
				Fn(this).append("<i class='iPlayed'></i>")
			} else if (this.title != a && Fn(this).html().indexOf('iPlayed') > -1) {
				Fn(this).html(Fn(this).html().split('<')[0])
			}
		}
	})
}
function fnRevertEpisode() {
	if (!id) return false;
	var a = st.sget('review_tag_value_' + id);
	if (!a) return false;
	fnEpisodeFoucs(a);
	show(a.split('_')[0], m.g('playNumTab').firstChild)
}
function doScroll() {
	xloadImg.muLoad('xload_mod_d1,xload_mod_d2,xload_mod_d3', 1);
	var a = document.documentElement.scrollTop + document.body.scrollTop;
	if (a > 0) {
		m.show(m.g("goTop"));
		if (navigator.appVersion.indexOf("MSIE 6") > -1) {
			var b = a + 210;
			m.g('rightMenu').style.position = 'absolute';
			m.g('rightMenu').style.top = b + 'px';
			m.g('feedbackBox').style.position = 'absolute';
			m.g('feedbackBox').style.top = b - 190 + 'px';
			m.g('feedbackSuccessBox').style.position = 'absolute';
			m.g('feedbackSuccessBox').style.top = b - 90 + 'px'
		} else {
			m.g('rightMenu').style.position = 'fixed';
			m.g('rightMenu').style.top = '240px';
			m.g('feedbackBox').style.position = 'fixed';
			m.g('feedbackBox').style.top = '150px';
			m.g('feedbackSuccessBox').style.position = 'fixed';
			m.g('feedbackSuccessBox').style.top = '250px'
		}
	} else {
		m.hide(m.g("goTop"));
		m.g('rightMenu').style.top = '240px'
	}
}
function reg_form_key(a) {
	var b = document.getElementById(a);
	var c = b.parentNode.getElementsByTagName('input')[0];
	c.onkeydown = function(e) {
		e = e ? e: window.event;
		if (13 == e.keyCode) {
			submit_com(a)
		}
	}
}
//reg_form_key('comment_textarea1');
//reg_form_key('comment_textarea2');
function fnImgCodeFocus(b) {
	b.color = '#666';
	if (b.value == '点此输入验证码') {
		b.value = ''
	}
	var c = b.parentNode.getElementsByTagName('img')[0];
	var a = b.parentNode.getElementsByTagName('a')[0];
	if (c.style.display == 'none') {
		c.src = imgCodeUrl;
		m.show(c);
		m.show(a)
	}
}
function fnImgCodeBlur(a) {
	if (a.value == '') {
		a.color = '#999';
		a.value = '点此输入验证码'
	}
}
function refreshImg(a) {
	var b = a.parentNode.getElementsByTagName('img')[0];
	if (b.style.display == 'none') {
		m.show(b)
	}
	b.src = imgCodeUrl + '?' + new Date().getTime()
}
window.onscroll = function() {
	//doScroll()
}
//doScroll();
if (m.g('info_list_con0') != undefined) {
	curInfoBlock = 0;
	show_info_list(0, 0)
}
/*
if (mediaType != 'movie') {
	fnRevertEpisode()
}
*/
function isIE() {
	var a = false
	if (navigator.userAgent.indexOf("MSIE") > 0) {
		a = true
	}
	return a
}
function fadeIn(a, b) {
	var i = 0;
	var c = c();
	if (c) {
		a.style.filter = "alpha(opacity=" + i + ")"
	} else {
		a.style.opacity = i / 100
	}
	a.style.display = "block";
	function filterIn() {
		if (c) {
			a.style.filter = "alpha(opacity=" + i + ")"
		} else {
			a.style.opacity = i / 100
		}
		i = i + 8;
		if (i < 100) {
			setTimeout(filterIn, b)
		} else {
			if (c) {
				a.style.filter = "alpha(opacity=100)"
			} else {
				a.style.opacity = 1
			}
		}
	}
	filterIn()
}
function doSomeTing(a) {
	var b = m.g(a);
	fadeIn(b, 50)
}